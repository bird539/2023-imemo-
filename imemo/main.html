<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8" meta http-equiv="content-language" content="ko">
    <title>imemo</title>
    <link rel="stylesheet" href="/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
</head>

<body>
    <div class="main">
    </div>



    <script src="/make_window.js"></script>
    <script src="/window_title_change.js"></script>
    <script src="/tap.js"></script>
    <script src="/workMemo.js"></script>
    <script src="/link.js"></script>
    <script src="/calculation.js"></script>
    <script src="/word.js"></script>
    <script src="/fullcalenderMain.js"></script>

    <script>
        //달력 사이즈 - whith, height
        //달력 타이틀, 달력 링크1, 달력 링크1, 달력 표시 색깔
        //0:['대표 달력 네임', with, height],
        //  [true,false,false], - 스케줄 보일지 말지
        //  ['타이틀1','타이틀2',null],
        //  ['색깔1', '색깔2',null],
        //  ['url1', 'url2', null]
        
        let Cal_showTap_array = [];
        const Cal_tapShow_array = localStorage.getItem("tapShow_array");
        if(Cal_tapShow_array != null){
            const Cal_parsed_tapShow_array = JSON.parse(Cal_tapShow_array);
            Cal_showTap_array = Cal_parsed_tapShow_array;
        }

        let calendarMakeArray = [];
        let divNameArray = [];
        

        function skill_apply_calendar(txt){
            const div_calendarName = `s${txt}`;
            if(div_calendarName.charAt(div_calendarName.length-1) == `4`){
                const w_divCalendar = document.querySelector(`.${div_calendarName}`);
                divNameArray.push(div_calendarName);
                let calendarArray = calendarSave(div_calendarName, 3);
                const calendarDivHead = document.createElement("div");

                const calendarForm = document.createElement("form");
                const calendarInputTitle = document.createElement("input");
                const calendarSubBtn = document.createElement("button");
                calendarSubBtn.innerText = "sub";
                calendarSubBtn.type = "submit";
                calendarInputTitle.placeholder = "calendar name";
                calendarForm.style.display = "inline-block";
                calendarForm.addEventListener("submit",calendarSubEvent);

                const calendarInputHeight = document.createElement("input");
                calendarInputHeight.placeholder = "basic Height : 473px";
                calendarInputHeight.style.display = "block";
                const calendarInputWidth = document.createElement("input");
                calendarInputWidth.style.display = "block";
                calendarInputWidth.placeholder = "basic width : 300px";


                
                calendarForm.appendChild(calendarInputHeight);
                calendarForm.appendChild(calendarInputWidth);
                calendarForm.appendChild(calendarInputTitle);
                calendarForm.appendChild(calendarSubBtn);
                calendarForm.style.display = "none";



                const calendarSchedulForm = document.createElement("form");
                const calendarSchedulInputTitle = document.createElement("input");
                calendarSchedulInputTitle.placeholder = "schedul title";
                calendarSchedulInputTitle.style.display = "block";
                const calendarSchedulInputUrl = document.createElement("input");
                calendarSchedulInputUrl.placeholder = "google calendar url";
                calendarSchedulInputUrl.style.display = "block";
                const calendarSchedulInputColor = document.createElement("input");
                calendarSchedulInputColor.placeholder = "schedul color";
                calendarSchedulInputColor.style.display = "inline-block";
                const calendarSchedulSubBtn = document.createElement("input");
                calendarSchedulSubBtn.type = "submit";
                calendarSchedulSubBtn.value = "sub";

                const calendarSchedulShowBtn = document.createElement("button");
                calendarSchedulShowBtn.innerText = "+ scadul";
                calendarSchedulShowBtn.addEventListener("click",showNewScadulForm);

                const calendarEditShowBtn = document.createElement("button");
                calendarEditShowBtn.innerText = "calendar edit";
                calendarEditShowBtn.addEventListener("click",showEditCalendarForm);
                

                calendarSchedulForm.appendChild(calendarSchedulInputTitle);
                calendarSchedulForm.appendChild(calendarSchedulInputUrl);
                calendarSchedulForm.appendChild(calendarSchedulInputColor);
                calendarSchedulForm.appendChild(calendarSchedulSubBtn);
                calendarSchedulForm.addEventListener("submit",schedulSubEvent);
                calendarSchedulForm.style.display = "none";

                
                let calenderNum = txt.split('_',2)[1];
                //보여줄 달력 select + 일정 추가할 달력 대상
                const calendarSelect = document.createElement("select");
                calendarSelect.addEventListener("change",showNewCalendarForm);
                for(i=0;i<calendarArray.length+1;i++){
                    const CalendarOption = document.createElement("option");
                    CalendarOption.value = `${calenderNum}_calendar_${i-1}`;
                    if(i < 1){
                        CalendarOption.innerText = "new calendar";
                    }else{
                        CalendarOption.innerText = `${calendarArray[i-1][0][0]}`;
                    }
                    calendarSelect.appendChild(CalendarOption);
                }
                calendarSelect.selectedIndex = 1;
                

                //0:0['대표 달력 네임', with, height],
                //  1[true, null,null,null,null], - 스케줄 보일지 말지
                //  2['타이틀1', null,null,null,null],
                //  3['색깔1', null,null,null,null],
                //  4['url1', null,null,null,null]
                //보여줄 달력 select
                const calendarFoot =  document.createElement("div");
                for(j=0;j<calendarArray.length;j++){
                    const calendarScheduleDiv = document.createElement("div");
                    let CalendarSchedule = calendarArray[j][2];
                    console.log(calendarArray[j][2]);
                    for(i=0;i<CalendarSchedule.length;i++){
                        const schedulDiv = document.createElement("div"); 

                        const editSheculForm = document.createElement("div");
                        const editInputTitle = document.createElement("input");
                        //editInputTitle.va
                        editInputTitle.placeholder = "text";
                        editInputTitle.value = CalendarSchedule[i]
                        const editInputUrl = document.createElement("input");
                        editInputUrl.placeholder = "calendar url";
                        editInputUrl.value = calendarArray[j][4][i];
                        const editInputColor = document.createElement("input");
                        editInputColor.placeholder = "color";
                        editInputColor.value = calendarArray[j][3][i];
                        const editSubBtn = document.createElement("button");
                        editSubBtn.type = "submit";
                        editSubBtn.innerText = "sub";
                        const editInputHide = document.createElement("input");
                        editInputHide.value =  `${calenderNum}_schedul_${j}_${i}`;
                        editInputHide.type = "hide";
                        editSheculForm.appendChild(editInputTitle);
                        editSheculForm.appendChild(editInputUrl);
                        editSheculForm.appendChild(editInputColor);
                        editSheculForm.appendChild(editInputHide);
                        editSheculForm.appendChild(editSubBtn);
                        editSheculForm.style.display = "none";

                        const schedulSpan = document.createElement("span");
                        const ScheduleCheckbox = document.createElement("input");
                        ScheduleCheckbox.type = "checkbox";
                        ScheduleCheckbox.value = `${calenderNum}_calendar_${i}`;
                        const SchedulText = document.createElement("span");
                        SchedulText.innerText = calendarArray[j][2][i];
                        const SchedulEditBtn = document.createElement("button");
                        SchedulEditBtn.innerText = "edit";
                        schedulSpan.appendChild(SchedulText);
                        schedulSpan.appendChild(ScheduleCheckbox);
                        schedulSpan.appendChild(SchedulEditBtn);
                        //ScheduleCheckbox.innerText = `${CalendarSchedule[i]}`;
                        schedulDiv.appendChild(schedulSpan);
                        schedulDiv.appendChild(editSheculForm);

                        schedulDiv.style.display = "inline-block";
                        calendarScheduleDiv.appendChild(schedulDiv);
                    }
                    calendarScheduleDiv.className = `${calenderNum}_schedul_${j}`;
                    if(j>0){
                        calendarScheduleDiv.style.display = "none";
                    }
                    calendarFoot.appendChild(calendarScheduleDiv);
                }

                calendarDivHead.appendChild(calendarForm);
                calendarDivHead.appendChild(calendarSelect);
                calendarDivHead.appendChild(calendarSchedulShowBtn);
                calendarDivHead.appendChild(calendarSchedulForm);
                calendarDivHead.appendChild(calendarEditShowBtn);
                
                const FullCalendarClassDiv = document.createElement("div");
                FullCalendarClassDiv.className = "FullCalender";
                FullCalendarClassDiv.style.width = "320px";
                for(i=0;i<calendarArray.length;i++){
                    const calendarDiv = document.createElement("div");
                    let plsMakeArray = [];
                    calendarMakeArray.push(`${calenderNum}_calendar_${i}`);
                    calendarDiv.className = `${calenderNum}_calendar_${i}`;
                    calendarDiv.style.width = `${calendarArray[i][0][1]}`
                    if(calendarSelect.selectedIndex-1 == i){
                        calendarDiv.style.display = "block";
                    }else{
                        calendarDiv.style.display = "none";
                    }
                    FullCalendarClassDiv.appendChild(calendarDiv);
                }

                w_divCalendar.appendChild(calendarDivHead);
                w_divCalendar.appendChild(FullCalendarClassDiv);
                w_divCalendar.appendChild(calendarFoot);

                w_divCalendar.style.display = "none";
                if (Cal_showTap_array != null) {
                    for (i = 0; i < Cal_showTap_array.length; i++) {
                        if (`${Cal_showTap_array[i]}` == txt) {
                            w_divCalendar.style.display = "block";
                        }
                    }
                }

            }
        }
        //함수-----
        function showNewCalendarForm(event){
            const targetSelect = event.target;
            const targetForm = event.target.previousSibling;
            const targetPlsScadulBtn = event.target.nextSibling;
            const targetCalendarEditBtn = event.target.nextSibling.nextSibling.nextSibling;
            if(targetSelect.selectedIndex == 0){
                targetForm.style.display = "inline-block";
                targetPlsScadulBtn.style.display = "none";
                targetCalendarEditBtn.style.display = "none";
            }else{
                targetForm.style.display = "none";
                const targetCalendar = document.querySelector(`.${targetSelect.value}`);
                const divName = event.target.parentElement.parentElement.className;
                const targetCalendarOther = document.querySelector(`.${divName}`).childNodes[1];
                for(i=0;i<targetCalendarOther.childNodes.length;i++){
                    targetCalendarOther.childNodes[i].style.display = "none";
                }

                targetPlsScadulBtn.style.display = "inline-block";
                targetCalendar.style.display = "block";
                targetCalendarEditBtn.style.display = "inline-block";
            }
        }

        function showNewScadulForm(event){
            const targetForm = event.target.nextSibling;
            if(targetForm.style.display=="none"){
                targetForm.style.display = "block";
            }else{
                targetForm.style.display = "none";
            }
        }
        function showEditCalendarForm(event){
            const targetSelect = event.target.previousSibling.previousSibling;
            const targetForm = event.target.previousSibling.previousSibling.previousSibling.previousSibling;
            if(targetForm.style.display == "none"){
                targetForm.style.display = "block";
            }else{
                targetForm.style.display = "none";
            }
        }

        function calendarSubEvent(event){
            const divName = event.target.parentElement.parentElement.className;
            const editBtn = event.target.nextSibling.nextSibling.nextSibling.nextSibling;
            const index = event.target.nextSibling.selectedIndex;
            const height = event.target.childNodes[0].value;
            const width = event.target.childNodes[1].value;
            const name = event.target.childNodes[2].value;
            if(editBtn.style.display == "none"){
                calendarSave(divName,0,0,name,Number(width), Number(height) );
            }else{
                calendarSave(divName,1,index-1,name,width, height );
            }
        }
        function schedulSubEvent(event){
            event.preventDefault();
            const divName = event.target.parentElement.parentElement.className;
            const index = event.target.previousSibling.previousSibling.selectedIndex;
            const title = event.target.childNodes[0].value;
            const url = event.target.childNodes[1].value;
            const color = event.target.childNodes[2].value;
            calendarSave(divName,2,index-1,title, url,color);
            
            //console.log( );
        }
        //-----함수

        //달력 저장-----
        //0:['대표 달력 네임', with, height, (선택된 달력일 시) true],
        //  [true, null,null,null,null], - 스케줄 보일지 말지
        //  ['타이틀1', null,null,null,null],
        //  ['색깔1', null,null,null,null],
        //  ['url1', null,null,null,null]
        function calendarSave(divName,select,option,text,url,color,check,option2){
            const getSaveCalendar = localStorage.getItem(divName);
                const getSaveCalendarPar = JSON.parse(getSaveCalendar);
                let calendarArray;
                if(getSaveCalendarPar!=null && getSaveCalendarPar.length !=0){
                    calendarArray = getSaveCalendarPar;
                }else{
                    calendarArray = [[
                        ["calendar1", 320, 473],
                        [true],
                        ['공휴일'],
                        ['blue'],
                        ['AIzaSyBPomniaEFpdI98NVQIpyxJqtPzbN-bYoo']
                    ]];
                }
                if(select == 0){ //new 달력
                    if(option == 0){
                        if(url == null || url.length == 0){
                            url = 320;
                        };
                        if(color == null || color.length == 0){
                            color = 473;
                        };
                        let newCalendar = [
                            [`${text}`, url, color],
                            [true],
                            [`공휴일`],
                            ['blue'],
                            ['AIzaSyBPomniaEFpdI98NVQIpyxJqtPzbN-bYoo']
                        ];
                        calendarArray.push(newCalendar);
                        localStorage.setItem(divName, JSON.stringify(calendarArray));
                        return calendarArray.length;
                    }
                }else if(select == 1){ //edit 달력
                    if(text == null || text.length == 0){
                        text = `title`;
                    };
                    if(url == null || url.length == 0){
                        url = 320;
                    };
                    if(color == null || color.length == 0){
                        color = 473;
                    };
                    let index = Number(option);
                    let editCalendar = calendarArray[index];
                    editCalendar[0][0] = text;
                    editCalendar[0][1] = url;
                    editCalendar[0][2] = color;
                    calendarArray[index] = editCalendar;
                    localStorage.setItem(divName, JSON.stringify(calendarArray));
                }else if(select == 2){ //일정 생성
                    if(text == null || text.length == 0){
                        text = `schedule`;
                    };
                    if(url == null || url.length == 0){
                        url = 'AIzaSyBPomniaEFpdI98NVQIpyxJqtPzbN-bYoo';
                    };
                    if(color == null || color.length == 0){
                        color = 'blue';
                    };
                    let index = Number(option);
                    let editCalendar = calendarArray[index];
                    let index2 = editCalendar[1].length;

                    editCalendar[1].push(true);
                    editCalendar[2].push(text);
                    editCalendar[3].push(color);
                    editCalendar[4].push(url);

                    calendarArray[index] = editCalendar;
                    localStorage.setItem(divName, JSON.stringify(calendarArray));
                    //return calendarArray;

                }else if(select == 3){//맨 처음 생성시 발생
                    localStorage.setItem(divName, JSON.stringify(calendarArray));
                    return calendarArray;
                    
                }else if(select == 4){ //일정 수정
                    if(text == null || text.length == 0){
                        text = `schedule`;
                    };
                    if(url == null || url.length == 0){
                        url = 'AIzaSyBPomniaEFpdI98NVQIpyxJqtPzbN-bYoo';
                    };
                    if(color == null || color.length == 0){
                        color = 'blue';
                    };
                    let index = Number(option);
                    let index2 = Number(option2);
                    let editCalendar = calendarArray[index];
                    editCalendar[1][index2] = text;
                    editCalendar[2][index2] = check;
                    editCalendar[3][index2] = color;
                    editCalendar[4][index2] = url;

                    calendarArray[index] = editCalendar;
                    localStorage.setItem(divName, JSON.stringify(calendarArray));
                }
            }

        //-------------start
        let divCalendar = [];
        const in_stor_tap_array_calendar = localStorage.getItem("tap_array");
        if(in_stor_tap_array_calendar != null){
            const parsed_tap3 = JSON.parse(in_stor_tap_array_calendar);
            divCalendar = parsed_tap3;
            divCalendar.forEach(skill_apply_calendar);
        }
        //-----달력저장

        //풀캘린더 ---------------------------
        //const bytes1 = window.CryptoJS.AES.decrypt(getData[0].calenderAPI, `${getData[0].calenderID}dexinnfigre167!`);
        
        //0:0['대표 달력 네임', with, height],
        //  1[true, null,null,null,null], - 스케줄 보일지 말지
        //  2['타이틀1', null,null,null,null],
        //  3['색깔1', null,null,null,null],
        //  4['url1', null,null,null,null]
        const basicUrl = `ko.south_korea#holiday@group.v.calendar.google.com`;
        const fakeUrl = "";
        const fakeColor = "blue"
        for(j=0;j<divNameArray.length;j++){
            let calendarArray2 = calendarSave(divNameArray[j], 3);
            let calenderNum = divNameArray[j].split('_',2)[1];
        for(i=0;i<calendarArray2.length;i++){
            var calendarEl = document.querySelector(`.${calenderNum}_calendar_${i}`);
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                contentHeight: 500,
                googleCalendarApiKey: 'AIzaSyBPomniaEFpdI98NVQIpyxJqtPzbN-bYoo',

                eventSources: [{
                    googleCalendarId: calendarArray2[i][4][0]==null ? fakeUrl : calendarArray2[i][4][0],
                    className: 'gcal-event', // an option!
                    color: calendarArray2[i][3][0]==null ? fakeUrl : calendarArray2[i][3][0],
                },
                {
                    googleCalendarId: calendarArray2[i][4][1]==null ? fakeUrl : calendarArray2[i][4][1],
                    className: 'gcal-event2', // an option!
                    color: calendarArray2[i][3][1]==null ? fakeUrl : calendarArray2[i][3][1],
                },
                {
                    googleCalendarId: calendarArray2[i][4][2]==null ? fakeUrl : calendarArray2[i][4][2],
                    className: 'gcal-event3', // an option!
                    color: calendarArray2[i][3][2]==null ? fakeUrl : calendarArray2[i][3][2],
                },
                {
                    googleCalendarId: calendarArray2[i][4][3]==null ? fakeUrl : calendarArray2[i][4][3],
                    className: 'gcal-event2', // an option!
                    color: calendarArray2[i][3][3]==null ? fakeUrl : calendarArray2[i][3][3],
                },
                {
                    googleCalendarId: calendarArray2[i][4][4]==null ? fakeUrl : calendarArray2[i][4][0],
                    className: 'gcal-event3', // an option!
                    color: calendarArray2[i][3][4]==null ? fakeUrl : calendarArray2[i][3][4],
                }
                
                ]
            });
            calendar.render();
        }
        }

        

        /*
            <div style="float: center; width: 320px;" class="FullCalender">
            <div class='calendar1'>
            </div>
            </div>
         */

        //------------풀캘린더
    </script>


</body>

</html>